# 本地智能投资工作台（A股）PRD

- 项目代号：DataAnalysis-Workbench
- 版本：v0.1
- 状态：Draft
- 日期：2026-01-24

## 1. 背景与机会
个人投资者做A股决策时，信息分散（行情/指标/财务/资金/新闻/研报/公告）、结论不可追溯（“为什么当时这么买”）、执行割裂（研究在A软件、下单在B软件、复盘在表格）。本项目目标是在“本地单机”形态下，把选股、研究、组合管理、模拟/实盘半自动下单确认、复盘沉淀串成一条闭环。

## 2. 目标用户
- 主要用户：A股个人投资者
- 核心诉求：
  - 看得懂：结论可解释（依据、参数、数据日期、口径）
  - 可执行：建议能落到“订单草稿”，并经过风控校验后由用户确认下单
  - 可复盘：任何一次建议/下单都能追溯到当时的输入、规则、数据版本

## 3. 产品定位
- 一句话：本地一体化的“选股雷达 + 个股工作台 + 组合管家 + 半自动交易助手”。
- 形态：本地单机 Web（浏览器访问），默认 SQLite 落地；数据与AI能力可插拔。
- 自动化边界：半自动（生成订单 + 用户确认），不做全自动交易。

## 4. 现有项目与分工（4个子仓库）
- `StockAnal_Sys`：Web 基座（页面、分析模块、可视化、基础数据访问/缓存思路可借鉴）
- `vnpy`：交易与量化基础设施（模拟/回测/实盘网关、订单/成交模型、风控与事件驱动框架可用）
- `FinRL`：策略研究/训练（离线），输出“信号/评分因子/策略配置”（不直接下单）
- `DeepResearch`：研究助理能力（信息搜集/总结/问答），输出“结论+依据+风险点+引用”（可插拔）

> 说明：本项目为“顶层集成仓库”。4个项目以“模块化接入”的方式组合：统一领域模型 + 统一数据层 + 统一API + 统一审计链。

## 5. 成功标准（V1）
- 闭环完成率：用户可从“雷达→候选→个股→计划→调仓→订单确认→模拟成交”完整走通
- 关键耗时：单票工作台打开与核心信息呈现稳定可用（依赖数据源与缓存策略）
- 可追溯：任一订单可追溯到当时的评分、计划、风控结果、数据版本
- 稳定性：外部数据源失败不导致系统崩溃，具备降级与重试

## 6. 范围与非目标
### 6.1 V1 范围
- A股股票/ETF
- 数据源：AKShare/TuShare（可插拔扩展）
- 交易：模拟交易为主（P0）；实盘半自动为增强（P1）
- AI：研究助理为增强（P1），可在无联网场景降级

### 6.2 非目标（V1不做）
- 全自动交易/无人值守
- 期货/期权/多币种/跨市场（先不做）
- 多人协作、云端SaaS账号体系
- 内置托管付费数据源账号（仅提供可插拔适配器）

## 7. 信息架构（导航）
- 首页：市场概览、组合风险提示、待办（复盘/研究/调仓）
- 选股雷达：范围选择 → 条件筛选 → 候选池 → 评分排序 → 一键进入个股
- 个股工作台：行情与指标、基本面/估值、资金流、新闻/公告、研究纪要、操作计划
- 组合管家：组合管理、持仓与绩效、风险暴露、预警、调仓建议、订单草稿
- 交易中心：模拟账户（P0），实盘半自动（P1）；订单草稿→风控→确认→下单/撮合
- AI研究助理：提问→资料整理→结论+依据+风险点（可写入纪要）
- 数据与模型：数据源管理、更新任务、缓存/落库、模型/策略版本与回测报告（P1/P2逐步完善）

## 8. 核心用户流程
1) 选股：配置扫描范围与条件 → 执行雷达任务 → 得到候选池与“命中原因”
2) 研究：进入个股工作台 → 查看全景信息 → 生成/编辑操作计划 → 写入研究纪要
3) 组合：将标的加入组合 → 查看风险与暴露 → 生成调仓建议 → 生成订单草稿
4) 执行：进入交易中心 → 风控校验 → 用户确认 → 模拟撮合（P0）/实盘下单（P1）
5) 复盘：订单/成交/计划/评分全链路追溯 → 导出报告

## 9. 核心功能需求（V1）
### 9.1 选股雷达
- 扫描范围（Universe）：全市场/指数成分/自定义列表/自选池
- 条件构建：技术/基本面/资金/事件（V1可先做最小可用集合），可保存模板
- 异步执行：任务队列、进度、可取消/重跑
- 输出：候选列表（得分、命中原因、关键指标快照），支持排序/过滤/导出

### 9.2 个股工作台
- 行情与指标：K线、常用指标可开关；复权口径明确标注
- 基本面/估值：核心指标摘要（字段缺失需降级）
- 资金流：按数据可得性展示（缺失需降级）
- 新闻/公告：列表、关键词高亮、收藏、引用到纪要
- 操作计划：结构化计划（入场/触发/止损止盈/仓位/风险点），可编辑、可版本化
- 研究纪要：笔记沉淀、引用回链、导出Markdown

### 9.3 组合管家
- 多组合管理；持仓/流水手工录入与CSV导入
- 组合指标：收益、回撤、仓位、集中度、行业暴露
- 预警：阈值可配（超仓、回撤、单票跌幅等）
- 调仓建议：生成目标调整与影响评估（现金变化、集中度变化）
- 订单草稿：可编辑、可合并/拆分、进入确认流程

### 9.4 交易中心（半自动确认）
- 模拟交易（P0）：撮合、手续费/滑点配置、订单/成交/持仓/资金曲线
- 风控校验：资金、超仓、价格偏离、涨跌停/停牌（可得则校验）
- 确认工作流：草稿→校验→用户确认→执行→状态回写
- 审计：每次确认前后的输入/输出快照可追溯

## 10. 数据与模型（原则）
- 数据源可插拔：AKShare/TuShare 默认；预留 Wind/iFinD/RQData 等扩展点
- 分层缓存：页面读取优先读库与缓存，避免直打外部API
- 数据质量：字段缺失/延迟/异常必须在UI可见；允许一键触发补数任务
- 模型/策略版本：任何评分/计划输出需记录版本号（P0先记录规则版本，P2再引入训练版本）

## 11. 非功能需求
- 性能：核心页面在数据已缓存情况下快速响应；慢操作必须异步任务化
- 稳定性：外部数据失败可降级；任务失败可重试与断点续跑
- 可观测：任务状态、耗时、错误码、最近更新时间；健康检查页
- 安全：密钥不入日志；本地存储可选加密（后续）
- 可维护：领域模型、API、数据表有版本与迁移；模块边界清晰

## 12. 风险与对策
- 免费数据不稳定：做provider降级、缓存、重试、质量提示；允许用户切到 TuShare/付费源
- 指标口径争议：显式标注复权/周期/计算参数；关键结果可复现
- “建议”不被信任：必须可解释、可编辑、可追溯；默认半自动确认
- 本地环境差异：提供一键启动与健康检查；错误信息可操作化

## 13. 验收标准（V1）
- 能在全新机器按文档启动并初始化数据库
- 雷达能跑通并产出候选池；候选点击进入个股工作台
- 工作台能生成并保存操作计划；纪要能引用新闻与计划版本
- 组合能导入/录入持仓；能生成调仓建议并生成订单草稿
- 订单草稿能走完：风控校验→用户确认→模拟成交→回写组合与台账
- 任一成交可追溯到：草稿、风控结果、计划版本、评分版本、数据更新时间
